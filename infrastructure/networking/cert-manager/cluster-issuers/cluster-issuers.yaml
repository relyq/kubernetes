apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    #server: https://acme-staging-v02.api.letsencrypt.org/directory
    email: relyqx@gmail.com
    privateKeySecretRef:
      name: letsencrypt-dns-account-key
    solvers:
    - dns01:
        cloudflare:
          email: relyqx@gmail.com
          apiTokenSecretRef:
            name: cloudflare-api-token-secret
            key: api-token
---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: vault-issuer
spec:
  vault:
    server: https://vault.vault.svc.cluster.local:8200
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURXekNDQWtPZ0F3SUJBZ0lVWStPcEs1M1FsaUhmY3YrSDFudFRUUmFHNnFjd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0pERWlNQ0FHQTFVRUF4TVpRMnhoYVhKbElGWmhkV3gwSUVsdWRHVnliV1ZrYVdGMFpUQWVGdzB5TlRBMwpNRFF4TVRFeU16UmFGdzB5TmpBMk1qZ3dNREF3TURCYU1Cb3hHREFXQmdOVkJBTU1EeW91WTJ4MWMzUmxjaTVzCmIyTmhiRENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFNeFpXcVJXUWxtYVdnUmoKYzFxTmc5akR5QkNkcklqUlFkV1BBZ0UzZHowVktoaTVqdnBLZEIrbEZZSVEzSExBM3FjaDFvbnNmREJCVFIrTgpXSmtSdFlTQTJZWEZEOTh3MnJ3bnBnV0tuTDFoV0hVMHhlNDdkVHZCVVpFOFVXQ0JLaFA4bHQ0VXhNbzEzUlRMCkFvWTYrY0lqdTNhUGU5WXJzM2lxRC9JTWdHd1RxcDdVbHRoSTJRWTk0dlFmRTZvT1ZtT1RCRUVuSEhxMlZlbWwKcHpuckJ5NEtNN1VMdmFDUjFDWXA1ZWFyLzNkNklvZ2cxMG00NmVZZ1hTckJ6TGRFcjVCZkVHbEV5K1ZnZ0VvMgpWWnNmcWtQNk5rU2ZtUm84Y1BYZnhjc084ck9ub2NvYzI2REZkSE91VzFHUUZWYW9QL0JYUGhzTDhOZllyWGlXCnFuV2paM1VDQXdFQUFhT0JqakNCaXpBT0JnTlZIUThCQWY4RUJBTUNBNmd3SFFZRFZSMGxCQll3RkFZSUt3WUIKQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQjBHQTFVZERnUVdCQlFoY1hjUm9iWTVldkpCTUk5SmErbWhEU3RnRFRBZgpCZ05WSFNNRUdEQVdnQlNEMTJyUlFXckZScURsT3VxNkxvY1BseUxHbWpBYUJnTlZIUkVFRXpBUmdnOHFMbU5zCmRYTjBaWEl1Ykc5allXd3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQ0VPc3NsVVRYWSs0TkM2aHF3blJyUlEKRnI5T1JmZC82TldjcDNQRmJnNFIxRENXSWg3V0ZlNlFyaWNwMk02OUc1RTVFd0grK24wQnVHN3FNR1Q3bUw4dgpGM3VSR1psSE4rMnJTUXpPL1hoRkZMSExlaE9lUi9mUkl3REFsYlpyRnlsWldNL2U1T3lrUjBWc25Kays2dEdmCnBzTVE3VUp5cXJ2RkJZNnZKa1BZcXdTYm5ZWUVYWjJyL1VqUWZmd3NKVXpLSUc4QzdkTUZqNFFmUkt4bmVKSk4KQVJZZ0JFcnZXRWJ3Z1JMdFgxRmRRQU9BcjF2VEl2S0p3SGRQMHBtcW1nS2x0ZEdNTTJ1ZS9uMytCT1BhOVU2QQpjeHNFcVNhL2NIeE44UTVoQXhWZndrbWtiWmNWUmVsSEdoUlpSVEF2bHEvbnFCaW9KMk9rVTZwRnBxaHJYSDg9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNaVENDQWd1Z0F3SUJBZ0lVYngwdlJUZndja0sybVhXT1hycFVnYmJOaHFzd0NnWUlLb1pJemowRUF3SXcKRVRFUE1BMEdBMVVFQXhNR1EyeGhhWEpsTUI0WERUSTFNRFl5T1RFME1EQXpNMW9YRFRJMk1EWXlPVEUwTURFdwpNMW93SkRFaU1DQUdBMVVFQXhNWlEyeGhhWEpsSUZaaGRXeDBJRWx1ZEdWeWJXVmthV0YwWlRDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUw5Tmsrd2FDbGRNZ3J0SkRrWWpUVnowL2p3bzVncTkKZWo1U3VJbVMyT1N5MzZLZTd5cFVpVU5IZ0xRaEJ2R2NlN1Y4cnFreDNLQURDQXBLZm9LNnhFQjJCQTMyOGpxdAplcGFpVHhXOGIzaUc2QkpMQWl3SDZ1bnVaS3VZRUd5d2RSQUllaTFkZkpaVHdJU1FNS2R2NUI1d2pnbWh2d24zCi96TWlxalRjYUdCNFpZQjJraWNOTForTitwSVFKQjFNZEUySTQzbzhrbVMrVmxxREc0aVhWSG9zUG0xd3BmRCsKNGk4Y1RHN3BuWHNQUUpySlJwYXJXei9tWW9nSVBmdHdaS1JuNEVnM1BVem8rK0tETytKRExWVTBSaC9mNGV4YgpmUGpnMy9USG83VHFlTExiYitxUmM5NUJ2ZlBBaVVyWkl5ZktjYVVvd3BxK3E3aUVjWkRGWXBrQ0F3RUFBYU5qCk1HRXdEZ1lEVlIwUEFRSC9CQVFEQWdFR01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZJUFgKYXRGQmFzVkdvT1U2NnJvdWh3K1hJc2FhTUI4R0ExVWRJd1FZTUJhQUZPTDV4VUNLQXZ5QzViNmhFVDdJRzk1UgpNa09VTUFvR0NDcUdTTTQ5QkFNQ0EwZ0FNRVVDSVFDSVhyakh4cmQ1aUtab0c5MGNrWlk2THFFSnF6dFFreVpJCkV2aVZxczUyQ2dJZ1FPTllwR3QybEVSbEF4Y29JOStrOTFDbWVQYjdzcGxmYkI5T2tzLzNDUzg9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJaekNDQVF5Z0F3SUJBZ0lSQU9WMWFzNGxxMTZqdms3OUhQQmVRdFV3Q2dZSUtvWkl6ajBFQXdJd0VURVAKTUEwR0ExVUVBeE1HUTJ4aGFYSmxNQjRYRFRJMU1EWXlPVEV6TlRBeE9Wb1hEVE0xTURZeU56RXpOVEF4T1ZvdwpFVEVQTUEwR0ExVUVBeE1HUTJ4aGFYSmxNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVDRVRDClhGTE5NQjVzUitSVjJuMjEwb2p6eThNYWQzUGhDb2ZIcmd3UU53eG81U2xSbmJLL1EzY0s2Tm9ZajQ1anoxUGMKZmJTRmJSZXVlNjhWMnduRG1hTkZNRU13RGdZRFZSMFBBUUgvQkFRREFnRUdNQklHQTFVZEV3RUIvd1FJTUFZQgpBZjhDQVFFd0hRWURWUjBPQkJZRUZPTDV4VUNLQXZ5QzViNmhFVDdJRzk1Uk1rT1VNQW9HQ0NxR1NNNDlCQU1DCkEwa0FNRVlDSVFENGNUNnNETTkvK2ZYSXpvRXFCcnBuUjBDNGo3YVZyQ1ZFWVluSkZ1Q2FtUUloQUl6S3JGZWIKNmUrbUNOTkZmSzJzTzBVUFRHZ0dIbFU4eWduWmZKTUhkd0FRCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    path: pki/sign/main
    auth:
      kubernetes:
        mountPath: /v1/auth/kubernetes
        role: vault-issuer
        serviceAccountRef:
          name: cert-manager
          audiences:
            - vault://cert-manager/cert-manager